# Layer 4 Implementation Analysis: Non-Normality Verification

## –í–æ–ø—Ä–æ—Å
**–ö–∞–∫ –≤ –∫–æ–¥–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –ø–æ–¥–≥—Ä—É–ø–ø–∞ –ù–ï–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è?**

---

## –û—Ç–≤–µ—Ç: –î–≤–∞ —É—Ä–æ–≤–Ω—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. **Runtime –ø—Ä–æ–≤–µ—Ä–∫–∞ (–≤ –∏–≥—Ä–µ)** ‚Äî `ConjugationCrackingManager.test_conjugation()`

**–§–∞–π–ª**: `TheSymmetryVaults/src/core/conjugation_cracking_manager.gd`
**–°—Ç—Ä–æ–∫–∏**: 131-184

#### –ê–ª–≥–æ—Ä–∏—Ç–º (—É–ø—Ä–æ—â—ë–Ω–Ω–æ):

```gdscript
func test_conjugation(g_sym_id: String, h_sym_id: String) -> Dictionary:
    # –®–∞–≥ 1: –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–ª—è g –∏ h
    var g_perm: Permutation = _sym_id_to_perm.get(g_sym_id)
    var h_perm: Permutation = _sym_id_to_perm.get(h_sym_id)

    # –®–∞–≥ 2: –í—ã—á–∏—Å–ª—è–µ–º —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç: g ¬∑ h ¬∑ g‚Åª¬π
    var g_inv: Permutation = g_perm.inverse()
    var conjugate: Permutation = g_perm.compose(h_perm).compose(g_inv)

    # –®–∞–≥ 3: –ù–∞—Ö–æ–¥–∏–º, –∫–∞–∫–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –≥—Ä—É–ø–ø—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    var result_sym_id: String = _find_sym_id_for_perm(conjugate)

    # –®–∞–≥ 4: –ö–õ–Æ–ß–ï–í–ê–Ø –ü–†–û–í–ï–†–ö–ê ‚Äî –≤ –ø–æ–¥–≥—Ä—É–ø–ø–µ –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç?
    var elements: Array = sg.get("elements", [])
    var stayed_in: bool = elements.has(result_sym_id)

    # –®–∞–≥ 5: –ï—Å–ª–∏ –ù–ï –≤ –ø–æ–¥–≥—Ä—É–ø–ø–µ ‚Üí —ç—Ç–æ "witness" (—Å–≤–∏–¥–µ—Ç–µ–ª—å –Ω–µ–Ω–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–∏)
    var is_witness: bool = not stayed_in

    # –®–∞–≥ 6: –ï—Å–ª–∏ found witness ‚Üí –ø–æ–¥–≥—Ä—É–ø–ø–∞ –ù–ï–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è!
    if is_witness:
        _classified[_active_subgroup_index] = {
            "is_normal": false,  # ‚Üê –ü–æ–¥–≥—Ä—É–ø–ø–∞ –Ω–µ–Ω–æ—Ä–º–∞–ª—å–Ω–∞!
            "witness_g": g_sym_id,
            "witness_h": h_sym_id,
            "witness_result": result_sym_id,
        }
        subgroup_cracked.emit(_active_subgroup_index, g_sym_id, h_sym_id, result_sym_id)
```

#### –õ–æ–≥–∏–∫–∞
- **–ï—Å–ª–∏ `g¬∑h¬∑g‚Åª¬π ‚àâ H`** (stayed_in = false) ‚Üí **–ø–æ–¥–≥—Ä—É–ø–ø–∞ –ù–ï–Ω–æ—Ä–º–∞–ª—å–Ω–∞** ‚úÖ
- **–ï—Å–ª–∏ –≤—Å–µ–≥–¥–∞ `g¬∑h¬∑g‚Åª¬π ‚àà H`** –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä ‚Üí –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å "–ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å"

---

### 2. **–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–≤–∞–ª–∏–¥–∞—Ü–∏—è)** ‚Äî `SubgroupChecker.is_normal()`

**–§–∞–π–ª**: `TheSymmetryVaults/src/core/subgroup_checker.gd`
**–°—Ç—Ä–æ–∫–∏**: 8-23

#### –ê–ª–≥–æ—Ä–∏—Ç–º (–ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä):

```gdscript
static func is_normal(subgroup: Array, group: Array) -> bool:
    # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –í–°–ï —ç–ª–µ–º–µ–Ω—Ç—ã –≥—Ä—É–ø–ø—ã G
    for g in group:
        var g_inv: Permutation = g.inverse()

        # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –í–°–ï —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–¥–≥—Ä—É–ø–ø—ã H
        for h in subgroup:
            # –í—ã—á–∏—Å–ª—è–µ–º —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã–π: g ¬∑ h ¬∑ g‚Åª¬π
            var conjugate: Permutation = g.compose(h).compose(g_inv)

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º: –µ—Å—Ç—å –ª–∏ conjugate –≤ –ø–æ–¥–≥—Ä—É–ø–ø–µ?
            var found: bool = false
            for s in subgroup:
                if s.equals(conjugate):
                    found = true
                    break

            # –ï—Å–ª–∏ –ù–ï –Ω–∞—à–ª–∏ ‚Üí –ø–æ–¥–≥—Ä—É–ø–ø–∞ –ù–ï–Ω–æ—Ä–º–∞–ª—å–Ω–∞!
            if not found:
                return false  # ‚Üê –ù–ï–Ω–æ—Ä–º–∞–ª—å–Ω–∞!

    # –í—Å–µ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã–µ –≤ H ‚Üí –ø–æ–¥–≥—Ä—É–ø–ø–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–∞
    return true  # ‚Üê –ù–æ—Ä–º–∞–ª—å–Ω–∞!
```

#### –õ–æ–≥–∏–∫–∞
- **–î–ª—è –í–°–ï–•** `g ‚àà G` –∏ `h ‚àà H`:
  - –ï—Å–ª–∏ **—Ö–æ—Ç—å —Ä–∞–∑** `g¬∑h¬∑g‚Åª¬π ‚àâ H` ‚Üí **return false** (–ù–ï–Ω–æ—Ä–º–∞–ª—å–Ω–∞)
- **–ï—Å–ª–∏ –≤—Å–µ–≥–¥–∞** `g¬∑h¬∑g‚Åª¬π ‚àà H` ‚Üí **return true** (–Ω–æ—Ä–º–∞–ª—å–Ω–∞)

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –ø–æ–¥—Ö–æ–¥–æ–≤

| –ê—Å–ø–µ–∫—Ç | Runtime (`test_conjugation`) | –í–∞–ª–∏–¥–∞—Ü–∏—è (`is_normal`) |
|--------|------------------------------|-------------------------|
| **–¶–µ–ª—å** | –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ ‚Äî –∏–≥—Ä–æ–∫ –∏—â–µ—Ç witness | –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö |
| **–ü–æ–ª–Ω–æ—Ç–∞** | –ß–∞—Å—Ç–∏—á–Ω–∞—è (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã) | –ü–æ–ª–Ω–∞—è (–í–°–ï –ø–∞—Ä—ã g,h) |
| **–°–∫–æ—Ä–æ—Å—Ç—å** | –ë—ã—Å—Ç—Ä–∞—è (–æ–¥–Ω–∞ –ø–∞—Ä–∞ –∑–∞ –≤—ã–∑–æ–≤) | –ú–µ–¥–ª–µ–Ω–Ω–∞—è (O(|G| √ó |H|¬≤)) |
| **–ö–æ–≥–¥–∞** | –ö–∞–∂–¥—ã–π –∫–ª–∏–∫ –∏–≥—Ä–æ–∫–∞ | –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —É—Ä–æ–≤–Ω—è, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ JSON |
| **–†–µ–∑—É–ª—å—Ç–∞—Ç** | –ù–∞—Ö–æ–¥–∏—Ç –û–î–ò–ù witness (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∏–≥—Ä—ã) | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –í–°–ï (–≥–∞—Ä–∞–Ω—Ç–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏) |

---

## –ö–∞–∫ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ù–ï–Ω–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å?

### –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:
–ü–æ–¥–≥—Ä—É–ø–ø–∞ `H ‚ä¥ G` **–Ω–æ—Ä–º–∞–ª—å–Ω–∞**, –µ—Å–ª–∏:
```
‚àÄg ‚àà G, ‚àÄh ‚àà H: g¬∑h¬∑g‚Åª¬π ‚àà H
```

–ü–æ–¥–≥—Ä—É–ø–ø–∞ **–ù–ï–Ω–æ—Ä–º–∞–ª—å–Ω–∞**, –µ—Å–ª–∏:
```
‚àÉg ‚àà G, ‚àÉh ‚àà H: g¬∑h¬∑g‚Åª¬π ‚àâ H
```

### –í –∫–æ–¥–µ:
1. **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–π—Ç–∏ –û–î–ù–£ –ø–∞—Ä—É** `(g, h)`, –≥–¥–µ `g¬∑h¬∑g‚Åª¬π ‚àâ H`
2. –≠—Ç–∞ –ø–∞—Ä–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **witness** (—Å–≤–∏–¥–µ—Ç–µ–ª—å)
3. Witness —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ JSON:
   ```json
   {
     "is_normal": false,
     "conjugation_witness": {
       "g": "s_ab",
       "h": "s_bc",
       "g_inv": "s_ab",
       "result": "s_dg"  // ‚Üê result –ù–ï –≤ subgroup!
     }
   }
   ```

---

## –ü—Ä–∏–º–µ—Ä: Level 22, –ø–æ–¥–≥—Ä—É–ø–ø–∞ {e, s_bc}

### Witness –∏–∑ JSON:
```json
{
  "g": "s_ab",
  "h": "s_bc",
  "g_inv": "s_ab",
  "result": "s_dg"
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä—É—á–Ω—É—é:

**–®–∞–≥ 1**: –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏:
- `s_ab = [1,0,3,2,5,4,7,6]` (swap A‚ÜîB)
- `s_bc = [0,2,1,3,4,6,5,7]` (swap B‚ÜîC)
- `s_ab‚Åª¬π = [1,0,3,2,5,4,7,6]` (–∏–Ω–≤–æ–ª—é—Ü–∏—è, —Å–∞–º —Å–µ–±–µ –æ–±—Ä–∞—Ç–Ω—ã–π)

**–®–∞–≥ 2**: –í—ã—á–∏—Å–ª—è–µ–º `s_ab ¬∑ s_bc`:
```
s_ab ¬∑ s_bc = [1,0,3,2,5,4,7,6] ‚àò [0,2,1,3,4,6,5,7]
            = [2,1,0,3,6,5,4,7]
```

**–®–∞–≥ 3**: –í—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç `(s_ab ¬∑ s_bc) ¬∑ s_ab‚Åª¬π`:
```
[2,1,0,3,6,5,4,7] ‚àò [1,0,3,2,5,4,7,6]
= [3,1,2,0,7,5,6,4]
```

**–®–∞–≥ 4**: –ü—Ä–æ–≤–µ—Ä—è–µ–º ‚Äî —ç—Ç–æ `s_dg`?
```
s_dg = [3,1,2,0,7,5,6,4]  ‚úÖ –î–∞!
```

**–®–∞–≥ 5**: –ü—Ä–æ–≤–µ—Ä—è–µ–º ‚Äî `s_dg` –≤ –ø–æ–¥–≥—Ä—É–ø–ø–µ `{e, s_bc}`?
```
e   = [0,1,2,3,4,5,6,7]
s_bc = [0,2,1,3,4,6,5,7]
s_dg = [3,1,2,0,7,5,6,4]  ‚ùå –ù–ï–¢!
```

**–í—ã–≤–æ–¥**: `s_ab ¬∑ s_bc ¬∑ s_ab‚Åª¬π = s_dg ‚àâ {e, s_bc}` ‚Üí –ø–æ–¥–≥—Ä—É–ø–ø–∞ **–ù–ï–Ω–æ—Ä–º–∞–ª—å–Ω–∞**! ‚úÖ

---

## –í—ã–≤–æ–¥ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–¥–∞

### ‚úÖ –õ–æ–≥–∏–∫–∞ –ö–û–†–†–ï–ö–¢–ù–ê
1. **Runtime –ø—Ä–æ–≤–µ—Ä–∫–∞** (`test_conjugation`) –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã—á–∏—Å–ª—è–µ—Ç `g¬∑h¬∑g‚Åª¬π`
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è** (`is_normal`) –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –ø–∞—Ä—ã
3. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º: –µ—Å–ª–∏ `g¬∑h¬∑g‚Åª¬π ‚àâ H` ‚Üí –ù–ï–Ω–æ—Ä–º–∞–ª—å–Ω–∞

### ‚ùå –î–∞–Ω–Ω—ã–µ –≤ Level 21 –ù–ï–ö–û–†–†–ï–ö–¢–ù–´
**–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ –ª–æ–≥–∏–∫–µ**, –∞ –≤ JSON-–¥–∞–Ω–Ω—ã—Ö:
- –î–≤–µ –ø–æ–¥–≥—Ä—É–ø–ø—ã Q8 –ø–æ–º–µ—á–µ–Ω—ã `is_normal: false`, –Ω–æ **–Ω–µ –∏–º–µ—é—Ç witness**
- –î–≤–∞ witness –≤—ã—á–∏—Å–ª–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –ù–ï —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π)

### üîç –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç
**–î–ª—è Q8 (–∫–≤–∞—Ç–µ—Ä–Ω–∏–æ–Ω—ã)**: –í–°–ï –ø–æ–¥–≥—Ä—É–ø–ø—ã –Ω–æ—Ä–º–∞–ª—å–Ω—ã!
–≠—Ç–æ **—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ** Q8 —Å—Ä–µ–¥–∏ –Ω–µ–∫–æ–º–º—É—Ç–∞—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø —Ç–∞–∫–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ö–æ–¥ –ù–ï —Ç—Ä–æ–≥–∞—Ç—å** ‚Äî –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Level 21**: –ø–æ–º–µ—Ç–∏—Ç—å –≤—Å–µ –ø–æ–¥–≥—Ä—É–ø–ø—ã –∫–∞–∫ `is_normal: true`, —É–±—Ä–∞—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–µ witnesses
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Q8 –¥–ª—è –æ–±—É—á–µ–Ω–∏—è**: "–°—Ç—Ä–∞–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞ ‚Äî –Ω–µ–∫–æ–º–º—É—Ç–∞—Ç–∏–≤–Ω–∞, –Ω–æ –≤—Å–µ –ø–æ–¥–≥—Ä—É–ø–ø—ã –Ω–æ—Ä–º–∞–ª—å–Ω—ã!"

---

## –ö–æ–¥ –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ witness

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª—é–±–æ–π witness –∏–∑ JSON –≤—Ä—É—á–Ω—É—é:

```python
def verify_witness(g_perm, h_perm, expected_result, subgroup_elements):
    """
    g_perm: list ‚Äî –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ g
    h_perm: list ‚Äî –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ h
    expected_result: list ‚Äî –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ JSON
    subgroup_elements: list of lists ‚Äî –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–¥–≥—Ä—É–ø–ø—ã

    Returns: (is_correct_computation, is_outside_subgroup)
    """
    # –®–∞–≥ 1: –í—ã—á–∏—Å–ª—è–µ–º g‚Åª¬π
    n = len(g_perm)
    g_inv = [0] * n
    for i in range(n):
        g_inv[g_perm[i]] = i

    # –®–∞–≥ 2: –í—ã—á–∏—Å–ª—è–µ–º g¬∑h
    gh = [g_perm[h_perm[i]] for i in range(n)]

    # –®–∞–≥ 3: –í—ã—á–∏—Å–ª—è–µ–º (g¬∑h)¬∑g‚Åª¬π
    result = [gh[g_inv[i]] for i in range(n)]

    # –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –æ–∂–∏–¥–∞–µ–º—ã–º
    is_correct = (result == expected_result)

    # –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –í–ù–ï –ø–æ–¥–≥—Ä—É–ø–ø—ã
    is_outside = result not in subgroup_elements

    return is_correct, is_outside

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (Level 22, witness –¥–ª—è {e, s_bc}):
g = [1,0,3,2,5,4,7,6]           # s_ab
h = [0,2,1,3,4,6,5,7]           # s_bc
expected = [3,1,2,0,7,5,6,4]    # s_dg
subgroup = [
    [0,1,2,3,4,5,6,7],          # e
    [0,2,1,3,4,6,5,7]           # s_bc
]

correct, outside = verify_witness(g, h, expected, subgroup)
print(f"–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ: {correct}")  # True
print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–Ω–µ –ø–æ–¥–≥—Ä—É–ø–ø—ã: {outside}") # True
```

---

**–î–∞—Ç–∞**: 2026-03-01
**–ê–≤—Ç–æ—Ä**: Math Consultant (Galois Theory Expert)
