# Task discussion T097: Implement Layer 3 engine: keyring assembly and subgroup validation

## [2026-02-27 22:08] boss (author)

### Task description

CONTEXT: Architecture from T096, subgroup catalog from T095.

TASK:
1. Read architecture from .tayfa/architect/T096_LAYER3_ARCHITECTURE.md
2. Read subgroup catalog from .tayfa/math_consultant/T095_SUBGROUP_CATALOG.md
3. Create keyring_assembly_manager.gd (or similar) in src/core/:
   - Manages active keyring state (which keys are in it)
   - Auto-validates after each add/remove: is current set a subgroup? (use SubgroupChecker)
   - Checks for duplicates (this subgroup already found)
   - Tracks all found subgroups
   - Detects completion (all subgroups found)
4. Extend layer_mode_controller.gd for LAYER_3_SUBGROUPS mode
5. Extend hall_progression_engine.gd for Layer 3 progress
6. Add subgroup_count to level JSON data (or compute from existing automorphisms)
7. Write unit tests for:
   - Adding/removing keys from keyring
   - Subgroup detection on add
   - Duplicate rejection
   - Trivial subgroup handling
   - Completion detection

VERIFICATION:
- Subgroup detection works for all group types (Z, D, S, A, Q8)
- Trivial subgroups ({e} and G) are findable
- Duplicate rejection works
- All unit tests pass

### Acceptance criteria

[To be clarified]

---
