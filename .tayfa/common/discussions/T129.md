# Task discussion T129: Обновить LayerModeController для двухфазного Layer 5

## [2026-03-02 11:51] boss (author)

### Task description

Переделать обработчики Layer 5 в layer_mode_controller.gd:

1. Убрать _on_construct_quotient() — больше нет кнопки Построить.
2. Новый flow:
   - Система АВТОМАТИЧЕСКИ берёт очередную нормальную подгруппу N (из найденных на Layer 4) -> начинается Шаг 1
   - Игрок НЕ выбирает N — они перебираются последовательно, как на предыдущих слоях
   - Игрок нажимает ⊕ на ключах -> on_coset_action_layer5(sym_id) -> валидация через manager
   - При заполнении класса -> обновить UI, подсветить на карте
   - При завершении Шаг 1 -> анимация склеивания на карте, переход к Шаг 2
   - Шаг 2: показать варианты типа, обработать выбор
   - При правильном типе -> quotient засчитана
3. Сброс карты при переключении между нормальными подгруппами.
4. Сохранение/восстановление промежуточного состояния (какие классы уже собраны).
5. Auto-complete для уровней без нормальных подгрупп (Z_p) — как раньше.

DEPENDS ON T126, T127, T128.

### Acceptance criteria

[To be clarified]

---
