# Task discussion T116: BUGFIX: Add h-in-subgroup validation to set_h() and test_conjugation()

## [2026-03-01 16:44] boss (author)

### Task description

CONTEXT: Math consultant report CRITICAL_BUG_LAYER4_H_SELECTION.md. UI-level protection works (KeyBar filters + on_target_selected validates), but data-level functions lack validation.

PRIORITY: MEDIUM (not CRITICAL — UI already prevents casual exploit)

TASK:
1. cracking_panel.gd: In set_h(), add validation that sym_id is in the active subgroup H. If not — return early with error feedback.
2. conjugation_cracking_manager.gd: In test_conjugation(), validate that h_sym_id is in the active subgroup elements. Return error dict if not.
3. Both are defense-in-depth — UI already prevents this, but data layer should be safe too.

FILES:
- src/ui/cracking_panel.gd — set_h() ~line 692
- src/core/conjugation_cracking_manager.gd — test_conjugation() ~line 131

VERIFICATION:
- Calling set_h() with sym_id not in H → rejected with feedback
- Calling test_conjugation() with h not in H → returns error
- Normal gameplay unchanged (UI already filters correctly)
- Tests pass

### Acceptance criteria

[To be clarified]

---
