# Task discussion T043: БАГФИКС: Пустое окошко цели (TargetPreview)

## [2026-02-27 08:28] boss (author)

### Task description

Баг: окошко цели в левом верхнем углу пустое — не отображает миниатюру графа с правильным расположением кристаллов.

ДИАГНОСТИКА:
1. TargetPreview (Control) создаётся в _ready() на строке 178-186 с visible=false
2. В _setup_target_preview() (строка 2325) создаётся TargetPreviewDraw (child node) с nodes_data и edges_data
3. Проблема может быть в данных: nodes_data передаётся сырым из JSON (позиции 640,220 etc.)
4. target_preview_draw.gd на строке 57 читает position из node_data — это должно работать
5. ВОЗМОЖНАЯ ПРИЧИНА: clip_contents=false, но parent Control может иметь нулевой размер в layout, или child nodes создаются но не рендерятся из-за timing issue с Godot

ЗАДАЧИ:
1. Проверить через Agent Bridge что TargetPreview существует в дереве (get_tree)
2. Проверить что TargetGraphDraw имеет дочерние ноды (Line2D, Polygon2D)
3. Если нод пустой — отследить nodes_data/edges_data при вызове setup()
4. Если ноды есть но не видны — проверить z_index, position, clipping
5. Добавить debug print в target_preview_draw.gd для диагностики
6. ИСПРАВИТЬ баг
7. Проверить на ВСЕХ 12 уровнях что миниатюра отображает правильный граф

MUST прочитать:
- src/visual/target_preview_draw.gd (163 строки — весь файл)
- src/game/level_scene.gd строки 177-186 (создание), 2324-2376 (setup)
- data/levels/act1/level_01.json (формат данных)

### Acceptance criteria

[To be clarified]

---
