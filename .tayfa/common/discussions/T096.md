# Task discussion T096: Architect: design Layer 3 UI layout and keyring assembly mechanics

## [2026-02-27 22:08] boss (author)

### Task description

CONTEXT: Layer 3 (gold) — player finds all subgroups by assembling keyrings.

KEY REQUIREMENTS FROM PRODUCT OWNER:
1. Crystal zone split into TWO sections:
   - LEFT (smaller): keyring assembly area — empty keyring slots, player drags key copies here
   - RIGHT: crystals + room map (same as Layers 1-2)
2. All keyring slots visible from start (count = total number of subgroups for this level, from T095)
3. Keyrings are initially empty
4. Player drags COPIES of keys into a keyring slot
5. AUTO-VALIDATION: after each add/remove, system checks if current set is a subgroup
6. If set IS a subgroup that hasn't been found before → keyring LOCKS (cannot be modified), move to next empty keyring
7. If set is NOT a subgroup → nothing happens, player continues
8. Include trivial subgroups ({e} and whole group G)
9. Completion: all keyring slots filled

TASK:
1. Design the split-screen layout:
   - How to divide crystal_rect into keyring zone + crystal zone
   - Responsive sizing (different group sizes → different number of keyrings)
2. Design keyring slot UI:
   - Empty state, filling state, locked state
   - How keys are displayed inside a keyring (colored dots? numbers?)
   - Visual distinction for trivial vs non-trivial keyrings
3. Design drag-and-drop mechanics:
   - Source: key_bar (keys are COPIED, not moved — player keeps all keys)
   - Target: active keyring slot
   - Remove: drag key out of keyring or tap to remove
4. Design validation feedback:
   - Subgroup found: gold glow animation, keyring locks, sound
   - Duplicate subgroup: gentle rejection (already found)
   - Not a subgroup: no reaction (or subtle hint after many failed attempts)
5. Design the data model:
   - How keyrings stored in save state
   - How level JSON provides subgroup count
   - Extension of layer_mode_controller for Layer 3

DELIVERABLE: .tayfa/architect/T096_LAYER3_ARCHITECTURE.md

### Acceptance criteria

[To be clarified]

---
