# Task discussion T048: Реализовать уровни 13-16 (JSON + интеграция в LevelScene)

## [2026-02-27 08:30] boss (author)

### Task description

Создать 4 уровня Акта 2 и интегрировать их в игру.

ЗАВИСИТ ОТ: T045 (мат. спецификации), T046 (архитектура), T047 (движок подгрупп)

ЗАДАЧИ:

1. **Создать JSON-файлы уровней**:
   - data/levels/act2/level_13.json .. level_16.json
   - Формат идентичен act1 + новые поля subgroups, inner_doors
   - Данные берутся из T045 (мат. спецификации)
   - Все тексты на русском языке

2. **Расширить LevelScene для поддержки внутренних дверей**:
   - Загрузка subgroups/inner_doors из JSON
   - UI панель внутренних дверей (справа от графа)
   - Режим выбора ключей: чекбоксы в KeyRingLabel
   - Кнопка 'ОТКРЫТЬ ДВЕРЬ': видна когда есть выбранные ключи
   - Валидация: вызов key_ring.check_subgroup()
   - Feedback: 
     * Успех: дверь открывается (анимация), звук, сообщение
     * Провал: трещина (анимация), сообщение 'Это подмножество не замкнуто'
   - Прогресс двери сохраняется

3. **Визуализация внутренних дверей на графе**:
   - Декоративные двери между кластерами узлов
   - Закрытая дверь: тёмная, с замком
   - Открытая дверь: светлая, без замка
   - Пульсация когда правильная подгруппа выбрана

4. **Условие завершения уровня** (расширить):
   - Старое: найти все ключи
   - Новое для Акта 2: найти все ключи + открыть все внутренние двери

5. **Обратная совместимость**: 
   - Уровни Акта 1 (без subgroups) работают как раньше
   - Проверить ВСЕ 12 уровней Акта 1 после изменений

6. **Расширение Agent Bridge**:
   - Команда select_keys(indices) — выбрать ключи для двери
   - Команда try_open_door(door_name) — попытаться открыть дверь
   - get_state() возвращает doors_status

7. **Тесты**:
   - Python unit test: загрузка level_13-16 JSON
   - Agent Bridge тест: пройти level_13 полностью (все ключи + все двери)

MUST прочитать:
- Результат T045 (JSON файлы уровней)
- Результат T046 (архитектурный документ)
- src/game/level_scene.gd (текущая логика)
- src/core/key_ring.gd (API после T047)

### Acceptance criteria

[To be clarified]

---
