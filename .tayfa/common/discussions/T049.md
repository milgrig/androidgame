# Task discussion T049: UI внутренних дверей: визуализация подгрупп и интерактивный выбор ключей

## [2026-02-27 08:30] boss (author)

### Task description

Создать UI-компоненты для механики внутренних дверей Акта 2.

НОВЫЕ ЭЛЕМЕНТЫ UI:

1. **InnerDoorVisual (src/ui/inner_door_visual.gd + .tscn)**:
   Визуальное представление внутренней двери на игровом поле.
   - Позиция: между кластерами узлов (координаты из JSON)
   - Состояния: LOCKED (тёмная, замок), UNLOCKED (открытая, свечение)
   - Анимация открытия: замок распадается, дверь раздвигается, свет
   - Анимация провала: трещина, shake, красная вспышка
   - Hover: показывает тултип 'Внутренняя дверь: нужно N ключей'

2. **SubgroupSelector (src/ui/subgroup_selector.gd + .tscn)**:
   Панель выбора ключей для открытия двери.
   - Появляется при клике на внутреннюю дверь
   - Показывает все найденные ключи в виде чекбоксов
   - Каждый ключ: имя + иконка перестановки (мини-диаграмма)
   - Кнопка 'ПРОВЕРИТЬ ПОДГРУППУ' — проверяет замкнутость
   - Feedback: зелёный если подгруппа, красный + 'чего не хватает' если нет
   - Кнопка 'ОТКРЫТЬ ДВЕРЬ' — активна только при валидной подгруппе

3. **Расширение KeyRingLabel**:
   - Новый режим: multi-select (чекбоксы рядом с ключами)
   - Визуальная группировка ключей по подгруппам (цветные рамки)
   - Индикатор найденных подгрупп

4. **Панель прогресса уровня (расширение)**:
   - Было: 'Ключи: 3/6'
   - Стало: 'Ключи: 3/6 | Двери: 1/2'
   - Иконки дверей: замок/галочка

5. **Анимация 'Момент понимания'**:
   Когда игрок впервые открывает внутреннюю дверь:
   - Камера плавно зумится на дверь
   - Подсветка ключей подгруппы
   - Текст: 'Вы нашли подгруппу\! Эти ключи замкнуты — любая комбинация двух из них даёт третий.'
   - Этот текст показывается ТОЛЬКО для первой двери во всей игре (не на каждом уровне)

Все тексты на русском языке.

СТИЛИСТИКА:
- Двери: каменные, рунические надписи, мистическое свечение
- Цветовая схема: бронза (замок), золото (открытая), красный (провал)
- Консистентность с кристаллами и картой мира

MUST прочитать:
- Результат T046 (архитектура)
- src/ui/hall_node_visual.gd (пример визуального стиля)
- src/visual/crystal_node.gd (drag/drop паттерн)
- src/visual/feedback_fx.gd (эффекты)

### Acceptance criteria

[To be clarified]

---
