# Task discussion T126: Шаг 1: Игрок сам собирает классы смежности (drag-and-drop комнат в группы)

## [2026-03-02 11:50] boss (author)

### Task description

КОНТЕКСТ: Сейчас классы смежности вычисляются автоматически кнопкой. Нужно сделать ГОЛОВОЛОМКУ: игрок сам группирует комнаты в классы.

ВАЖНО: Нормальные подгруппы уже найдены игроком на Layer 4. Игрок НЕ выбирает N — система перебирает их последовательно.

МЕХАНИКА:
1. Система берёт первую нормальную подгруппу N (уже известна с Layer 4). Показывает: "Разбей G на классы смежности по N = {e, ...}".
2. Элементы N уже подсвечены как первый класс (eN = N). Игрок должен разложить ОСТАЛЬНЫЕ комнаты по классам.
3. На room_map комнаты подсвечиваются. Внизу/слева — слоты для классов (кол-во = |G/N|). Первый слот уже заполнен = N.
4. Каждый пустой слот-класс ждёт заполнения. Игрок нажимает ⊕ на ключе в key_bar, чтобы добавить комнату в текущий активный класс.
5. Первая комната в новом классе становится представителем (representative g), остальные = gH.
6. Авто-валидация при каждом добавлении: если комната НЕ принадлежит тому же классу смежности — красная вспышка, комната отклоняется.
7. Когда класс заполнен (|N| элементов) — он блокируется зелёным, открывается следующий.
8. Когда все классы заполнены — Шаг 1 пройден, переход к Шагу 2.
9. После Шага 2 — переход к следующей нормальной подгруппе (если есть).

ФАЙЛЫ: quotient_panel.gd (переписать), quotient_group_manager.gd (добавить validate_coset_membership, is_valid_coset).

ВЕРИФИКАЦИЯ:
- Игрок АКТИВНО группирует, а не нажимает кнопку
- Неправильная группировка отклоняется
- Правильная группировка блокируется

### Acceptance criteria

[To be clarified]

---
