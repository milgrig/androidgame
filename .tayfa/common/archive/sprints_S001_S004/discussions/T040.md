# Task discussion T040: Кнопка ПОВТОРИТЬ + фикс кнопок на сложных уровнях

## [2026-02-26 15:30] boss (author)

### Task description

Две связанные проблемы найдены при игре на level_11 (Z6, гексагон).

### ПРОБЛЕМА 1: Кнопки не работают на level_11

Кнопки (включая СКОМБИНИРОВАТЬ) не реагируют на клики.
Вероятные причины: хитбокс KeyRingLabel, line_height=18px, перекрытие элементов.

### ПРОБЛЕМА 2: Кнопка ПОВТОРИТЬ (Apply/Repeat)

Повторять можно **ЛЮБОЙ** найденный ключ — поворот, отражение, тождество.
Игрок выбирает ключ из связки → этот ключ становится «активным».
Кнопка ПОВТОРИТЬ применяет активный ключ к текущему расположению.

**Анимация ПОВТОРЕНИЯ — должна быть красивой:**
1. Подготовка (0.2с): кристаллы приподнимаются, дуговые стрелки появляются
2. Перемещение (0.5с): кристаллы летят по Bezier-дугам (не по прямой!), trail-эффект, эффект «карусели» для циклов
3. Приземление (0.2с): bounce + вспышка + валидация результата

### Acceptance criteria

1. [ ] Все кнопки работают на level_11 (Z6, 6 ключей)
2. [ ] Кнопка ПОВТОРИТЬ видна когда найден хотя бы 1 ключ
3. [ ] Можно выбрать ЛЮБОЙ ключ для повторения (клик по ключу в связке)
4. [ ] Текст кнопки показывает имя активного ключа: «ПОВТОРИТЬ: Поворот 60°»
5. [ ] Анимация перемещения — по дугам, с trail, с bounce при приземлении
6. [ ] Для циклических перестановок — визуальный эффект «карусели»
7. [ ] level_11: выбрать r1, жать ПОВТОРИТЬ 5 раз → все 6 ключей найдены
8. [ ] level_05 (D4): повторить r1 → r2, r3. Повторить s1 → порядок 2 (e, s1, e...)
9. [ ] Добавлена команда Agent Bridge: repeat_key(key_index)

---

## [2026-02-26 15:44] boss (update: owner feedback)

Уточнение от владельца продукта:
- Каждый ключ можно повторять — хоть поворот на 90, хоть зеркальный, хоть тождественный
- Анимация повторения ДОЛЖНА быть красивой — это ключевой момент UX
- Кнопка нужна потому что СКОМБИНИРОВАТЬ требует слишком много кликов для простого повторения

---
