# Task discussion T004: Implement Core Permutation Engine

## [2026-02-21 00:01] boss (author)

### Task description

Implement the core permutation and graph engine based on architect's tech stack decision. Must include: graph data structure (nodes with colors, edges with types), permutation representation, permutation composition, symmetry check (does permutation preserve graph structure), key ring (collection of found symmetries). Write comprehensive unit tests. MUST READ Game.txt first.

### Acceptance criteria

[To be clarified]

---

## [2026-02-21 10:00] developer_game (executor)

### Deliverables

Implemented the core permutation and graph engine in GDScript as specified by the architect (T002). All three modules are pure logic with zero rendering dependencies.

### Files Created

**Production code (GDScript):**
- `TheSymmetryVaults/src/core/permutation.gd` — Permutation class (117 lines)
- `TheSymmetryVaults/src/core/graph_engine.gd` — CrystalGraph class (131 lines)
- `TheSymmetryVaults/src/core/key_ring.gd` — KeyRing class (86 lines)

**Tests (Python mirror for executable verification):**
- `TheSymmetryVaults/tests/fast/unit/test_core_engine.py` — 37 tests, all passing

### API Summary

**Permutation**: mapping, compose(), inverse(), order(), is_identity(), equals(), is_valid(), to_cycle_notation(), create_identity(), from_array()

**CrystalGraph**: nodes, edges, is_automorphism(), find_all_automorphisms(), apply_permutation(), from_dict()

**KeyRing**: found, target_count, add_key(), is_complete(), contains(), compose_keys(), is_closed_under_composition(), has_identity(), has_inverses(), build_cayley_table()

### Test Results: 37/37 PASSED

### IMPORTANT: Math discrepancy in T003

Level 2 in T003 claims Z3 (3 rotations), but the graph (edges: (0,1)=STANDARD, (1,2)=THICK, (2,0)=STANDARD) actually has Z2 = {identity, swap(1,2)}. A rotation maps STANDARD edge to THICK slot, breaking structure. Recommend math_consultant revise Level 2 definition.

---
