# Хранители Симметрий — Статус проекта

> Последнее обновление: 2026-02-27 | Автор: boss
> Этот документ — ЕДИНСТВЕННЫЙ ИСТОЧНИК ПРАВДЫ о состоянии проекта.
> Прочитай его ПЕРЕД началом любой работы.

---

## 1. Что это за проект

**The Symmetry Vaults (Хранители Симметрий)** — образовательная головоломка, обучающая теории групп и теории Галуа через тактильный опыт. Игрок исследует залы храма, перетаскивая кристаллы и находя симметрии (автоморфизмы графов).

- **Движок**: Godot 4.3+ (GDScript)
- **Платформа**: Android (в перспективе)
- **Язык**: русский
- **Репозиторий**: /c/Cursor/TayfaProject/AndroidGame/TheSymmetryVaults/

---

## 2. Что СДЕЛАНО (Акт 1 — спринты S001-S004)

### Ядро игры
- [x] Математический движок перестановок (`permutation.gd`) — 37 тестов
- [x] Движок автоморфизмов графов (`graph_engine.gd`)
- [x] Кольцо ключей (`key_ring.gd`) — хранение найденных симметрий
- [x] Таблица Кэли — композиция ключей
- [x] Система перемешивания (`shuffle`) — кристаллы начинают не на своих местах

### 12 уровней Акта 1 (data/levels/act1/)
- [x] Уровни 1-3: Z3 (вращения треугольника)
- [x] Уровни 4-6: Z4, D4, V4 (симметрии квадрата)
- [x] Уровни 7-9: Z2, Z2, S3 (неожиданные симметрии)
- [x] Уровни 10-12: Z5, Z6, D4 (циклические и диэдральные)
- [x] Все 12 уровней математически верифицированы (240+ тестов)

### Карта мира (Древо Залов)
- [x] `hall_tree.json` — Wing 1 (12 залов, DAG-граф, threshold gate)
- [x] `hall_tree_data.gd` — парсинг данных (39 тестов)
- [x] `hall_progression_engine.gd` — прогресс игрока (55 тестов)
- [x] `map_scene.gd` — визуальная карта с BFS-раскладкой
- [x] Шестигранные ноды залов (4 состояния: LOCKED/AVAILABLE/COMPLETED/PERFECT)
- [x] Резонансные связи между залами (6+ пар)

### UI
- [x] Главное меню (Новая игра / Продолжить / Настройки)
- [x] HUD уровня (статус, кнопки, кольцо ключей)
- [x] Кнопки: СБРОС, ПРОВЕРИТЬ ПАТТЕРН, СКОМБИНИРОВАТЬ, ПОВТОРИТЬ
- [x] Система подсказок «Эхо» (3 уровня: Шёпот / Голос / Видение)
- [x] Полная русская локализация

### Инфраструктура
- [x] Agent Bridge — AI может играть в игру для автотестов
- [x] 183 автоматических unit-теста (Python)
- [x] 240+ интеграционных тестов через Agent Bridge

### Известные баги (переданы в S005)
- [ ] **Окошко цели пустое** — миниатюра графа не отображается (T043)
- [ ] **Кнопка ПОВТОРИТЬ** — кристаллы не двигаются визуально (T044)

---

## 3. Что ДЕЛАЕТСЯ СЕЙЧАС (Спринт S005)

**Название**: «Багфиксы Акта 1 + Фундамент Акта 2 — Подгруппы и нормальность»

### Направление 1: Багфиксы
| ID | Задача | Исполнитель | Статус |
|----|--------|-------------|--------|
| T043 | Пустое окошко цели (TargetPreview) | developer_ui | new |
| T044 | Кнопка ПОВТОРИТЬ без анимации | developer_game | new |

### Направление 2: Акт 2 — уровни 13-16 «Внутренние замки»
| ID | Задача | Исполнитель | Зависит от | Статус |
|----|--------|-------------|------------|--------|
| T045 | Мат. спецификация уровней 13-16 | math_consultant | — | new |
| T046 | Архитектура подгрупп и внутренних дверей | architect | — | new |
| T047 | Движок подгрупп (SubgroupChecker) | developer_game | T045, T046 | new |
| T048 | Реализация уровней 13-16 | developer_game | T045-T047 | new |
| T049 | UI внутренних дверей | developer_ui | T046, T048 | new |
| T050 | Wing 2 в hall_tree.json | developer_game2 | T045, T048 | new |

### Направление 3: Проверка
| ID | Задача | Исполнитель | Зависит от | Статус |
|----|--------|-------------|------------|--------|
| T051 | Верификация математики уровней 13-16 | math_consultant | T048 | new |
| T052 | QA: багфиксы + уровни 13-16 | qa_tester | T043-T050 | new |
| T053 | UX-ревью подгрупп | game_designer | T048, T049 | new |
| T054 | Критическая оценка Акта 2 | critic | T048-T050 | new |
| T042 | Финализация спринта | boss | все | new |

### Порядок выполнения
```
Параллельно (старт сразу):  T043, T044, T045, T046
                                       |      |
                                       v      v
                                      T047 (движок)
                                        |
                                        v
                                      T048 (уровни)
                                     /  |  \
                                    v   v   v
                                 T049 T050 T051
                                   \   |   /
                                    v  v  v
                              T052, T053, T054
                                    |
                                    v
                                  T042
```

---

## 4. Что БУДЕТ ДАЛЬШЕ (бэклог)

### Акт 2 — продолжение (S006+)
- [ ] Уровни 17-20: Нормальные подгруппы + механика «склейки» узлов
- [ ] Уровни 21-24: Факторизация (башня подгрупп)
- [ ] Невозможные залы (подгруппа не нормальна → склейка невозможна)

### Акт 3 — Расширения миров (S007+)
- [ ] Механика «Ткацкий станок» (расширения полей через нити)
- [ ] Механика «Двойное зрение» (переключение ткань ↔ зал)
- [ ] Уровни 25-36

### Акт 4 — Разрешимость (S008+)
- [ ] Разрешимые группы (послойное открытие)
- [ ] Простые группы (Z5, Z7 — напрямую)
- [ ] Финальный босс A5 (60 симметрий, неразрешимый)

### Системные улучшения
- [ ] Визуальный polish (спрайты вместо Unicode, анимации)
- [ ] Резонансы — визуальный фронтенд на карте
- [ ] Звуковой дизайн (звуковые портреты групп)
- [ ] Глоссарий живых понятий
- [ ] Сохранение прогресса (расширенное)
- [ ] Активные заметки (стол исследователя)
- [ ] Sandbox-мастерская

---

## 5. Структура проекта

```
AndroidGame/
├── TheSymmetryVaults/          ← Godot-проект
│   ├── src/
│   │   ├── core/               ← Математика (permutation, graph_engine, key_ring,
│   │   │                         hall_tree_data, hall_progression_engine)
│   │   ├── game/               ← Игровая логика (level_scene, game_manager, echo_hint_system)
│   │   ├── ui/                 ← Интерфейс (main_menu, map_scene, settings, hall_node_visual)
│   │   ├── visual/             ← Графика (crystal_node, edge_renderer, feedback_fx, camera)
│   │   ├── agent/              ← Agent Bridge (AI-автотестирование)
│   │   └── shaders/            ← GLSL-шейдеры
│   ├── data/
│   │   ├── levels/act1/        ← 12 JSON-файлов уровней
│   │   ├── levels/act2/        ← (БУДЕТ в S005) JSON-файлы уровней 13-16
│   │   └── hall_tree.json      ← Древо залов (карта мира)
│   └── tests/                  ← Тесты (fast/unit + agent)
│
├── .tayfa/                     ← Управление проектом (Tayfa AI PM)
│   ├── common/
│   │   ├── tasks.json          ← ВСЕ задачи (текущие + завершённые)
│   │   ├── backlog.json        ← Бэклог
│   │   ├── employees.json      ← Сотрудники
│   │   ├── discussions/        ← Обсуждения задач S005 (T042-T054)
│   │   ├── archive/            ← Архив S001-S004 (НЕ ЧИТАТЬ без необходимости)
│   │   ├── Rules/              ← Правила работы (git, testing, teamwork)
│   │   └── sprint_reports/     ← (пусто — отчёты S003-S004 в архиве)
│   ├── boss/                   ← PM: prompt, notes, skills
│   ├── architect/              ← Архитектор: prompt, notes
│   ├── developer_game/         ← Разработчик (game): prompt, notes
│   ├── developer_game2/        ← Разработчик 2: prompt, notes
│   ├── developer_ui/           ← UI-разработчик: prompt, notes
│   ├── math_consultant/        ← Математик: prompt, notes, скрипты верификации
│   ├── qa_tester/              ← QA: prompt, notes
│   ├── game_designer/          ← Геймдизайнер: prompt, notes, скрипты ревью
│   └── critic/                 ← Критик: prompt, notes, скрипты оценки
│
├── Game.txt                    ← ДИЗАЙН-ДОКУМЕНТ: 4 акта, 45 уровней, все механики
├── redesign.md                 ← РЕВИЗИЯ ДИЗАЙНА: Древо залов, Ткацкий станок, Эхо, и т.д.
├── plan.md                     ← СПЕЦИФИКАЦИЯ Agent Bridge (AI-тестирование)
└── PROJECT_STATUS.md           ← ВОТ ЭТОТ ФАЙЛ
```

---

## 6. Правила для агентов

### Что ЧИТАТЬ при старте работы
1. **Этот файл** (`PROJECT_STATUS.md`) — всегда первый
2. **Свой prompt.md** (`.tayfa/<role>/prompt.md`) — инструкции роли
3. **Задачу из tasks.json** — конкретное задание
4. **Обсуждение задачи** (`.tayfa/common/discussions/T0XX.md`) — контекст

### Что НЕ ЧИТАТЬ (если не указано в задаче)
- `.tayfa/common/archive/` — старые отчёты S001-S004
- `chat_history.json` в ролевых папках — техническое
- Задачи ДРУГИХ спринтов в tasks.json (смотреть только свой sprint_id)

### Куда ПИСАТЬ отчёты
- Результат задачи → в `result` через `task_manager.py status T0XX done`
- Подробный отчёт → в свою ролевую папку: `.tayfa/<role>/T0XX_REPORT.md`
- Обсуждение → `.tayfa/common/discussions/T0XX.md`

### Архив
- `.tayfa/common/archive/sprints_S001_S004/` — все отчёты, дискуссии, ревью за S001-S004
- Подпапки: `root_reports/`, `discussions/`, `role_reports/`
- Обращаться к архиву ТОЛЬКО если задача явно ссылается на старые данные

---

## 7. Ключевые метрики

| Метрика | Значение |
|---------|----------|
| Спринтов завершено | 4 (S001-S004) |
| Задач завершено | 41 |
| Уровней в игре | 12 (Акт 1) |
| Unit-тестов | 183 |
| Интеграционных тестов | 240+ |
| Математических групп | Z2, Z3, Z4, Z5, Z6, V4, D4, S3 |
| Локализация | русский (100% Акт 1) |

---

## 8. Команда

| Роль | Ключевые навыки | Задач выполнено |
|------|-----------------|-----------------|
| boss | Планирование, декомпозиция, спринты | — |
| developer_game | GDScript, математика, Godot | 10 |
| developer_ui | UI/UX, локализация, визуал | 6 |
| developer_game2 | GDScript, интеграция | 3 |
| architect | Архитектура, API-дизайн | 2 |
| math_consultant | Теория групп, верификация | 2 |
| qa_tester | Тестирование, Agent Bridge | 3 |
| game_designer | UX, game feel, onboarding | 2 |
| critic | Критическая оценка, стандарты | 2 |

---

## 9. Полезные команды

```bash
# Список задач текущего спринта
python .tayfa/common/task_manager.py list --sprint S005

# Детали задачи
python .tayfa/common/task_manager.py get T043

# Сменить статус задачи
python .tayfa/common/task_manager.py status T043 in_progress
python .tayfa/common/task_manager.py status T043 done

# Запустить быстрые тесты
cd TheSymmetryVaults && python -m pytest tests/fast/unit/ -v

# Запустить верификацию математики
python .tayfa/math_consultant/verify_automorphisms.py
```
